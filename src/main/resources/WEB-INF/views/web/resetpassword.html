<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="author" content="usucai" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="keywords" content="logo,素材,素材下载,logo下载,矢量素材,素材下载,矢量logo,UI设计,设计,图标,设计素材,design,logo设计,平面设计,UI设计,网站设计,APP设计" />
	<meta name="description" content="优素材(usucai),设计师素材下载,专为UI设计,网页设计,平面设计等提供便利的平台" />
	<link rel="shortcut icon " type="images/x-icon" href="images/favicon.png">
	<link rel="stylesheet" href="${ctxPath}/css/web/style.css">
	<link href="${ctxPath}/js/plugins/layui/css/layui.css?v=2.4.5" rel="stylesheet"/>
	<title>重置密码 - 优素材 (usucai)</title>
	<script type="text/javascript">
		window.onload =function(){
			var img = document.getElementById("image");
			var ran = Math.floor(Math.random()*2);
			img.src = "images/random/" + ran + ".png";
		}		
	</script>
</head>
<body>
	<div class="login">
		<div class="login-box">
			<h1>重置密码<span>欢迎来到优素材网站，使用手机验码重置您的密码</span></h1>
			<div class="login-content">
				<form id="form1" class="layui-form mt" role="form" action="">
					<label>账号</label>
					<div><input class="username" type="text" name="phone" placeholder="手机号码/账号"></div>
					<label>手机验证码</label>
					<div>
						<input class="get" type="text" name="code" placeholder="手机验证码">
						<a lay-filter="smsCode" lay-submit class="getcode">获取验证码</a>
					</div>
					<label>设置密码</label>
					<div><input class="username" type="password" name="password" placeholder="设置密码"></div>
					<button lay-filter="reset" lay-submit class="u-signin btn">确定</button>
				</form>
				<div class="login-info">为了保证您的信息安全，我们不会在优素材(usucai)以外使用您的信息。</div>
				<div class="login-info">您也可以<a href="${ctxPath}/user/login">登录</a><a href="${ctxPath}/user/register">注册</a></div>
			</div>
			<div class="login-copyright">Copyright © 2021 Usucai. All Rights Reserved</div>
		</div>
		<div class="login-show">
			<div class="usucai icon-logo"></div>
			<p>设计，让世界更出彩</p>
			<div class="work-show"><img id="image" src="" alt=""></div>
		</div>
	</div>

	<script type="text/javascript" src="${ctxPath}/js/jquery.min.js?v=2.1.4"></script>
	<script type="text/javascript" src="${ctxPath}/js/plugins/layui/layui.js?v=2.4.5"></script>
	<script type="text/javascript" src="${ctxPath}/js/common.js"></script>
	<script>
		layui.use('form', function(){
			const form = layui.form;

			//监听提交
			form.on('submit(smsCode)', function(data){
				const phone = data.field.phone;
				if (!phone) {
					layer.msg('请输入手机号码');
					return false;
				}
				if(!(/^1(3|4|5|6|7|8|9)\d{9}$/.test(phone))){
					layer.msg('请输入正确的手机号码');
					return false;
				}

				var smsFlag = true;
				var smsTime = 60;
				var codeStr = '获取验证码';
				const fields = data.field;
				util.post("${ctxPath}/sms/forget-pwd", fields, function(res){
					if(res.code==200){
						layer.msg(res.msg);
						smsFlag = false;
						var max = smsTime;
						codeStr = max + 's';
						const timer = setInterval(function () {
							max--
							if (max >= 0) {
								codeStr = max + 's'
							} else {
								clearInterval(timer)
								codeStr = '重新获取'
								smsFlag = true
							}
							$(".getcode").html(codeStr);
						}, 1000)
					}else{
						layer.open({
							content: data.msg==null?"获取失败":data.msg,
							btn: '我知道了'
						});
					}
				});
				return false;
			});

			//监听提交
			form.on('submit(reset)', function(data){
				const fields = data.field;
				const phone = $.trim(fields.phone);
				const password = $.trim(fields.password);
				const smsCode = $.trim(fields.smsCode);

				if (!phone) {
					layer.msg('请输入手机号码');
					return
				}
				if(!(/^1(3|4|5|6|7|8|9)\d{9}$/.test(phone))){
					layer.msg('请输入正确的手机号码');
					return false;
				}
				if (!password) {
					layer.msg('请输入密码');
					return
				}
				if (!smsCode) {
					layer.msg('请输入验证码');
					return
				}
				util.post("${ctxPath}/user/reset/password", fields, function(res){
					if(res.code==200){
						location.href="${ctxPath}/";
					}else{
						layer.open({
							content: data.msg==null?"重置失败":data.msg,
							btn: '我知道了'
						});
					}
				});
				return false;
			});
		});
	</script>
</body>
</html>